<%= render "shared/header" %>
<div class="show-main">

  <div class="show-main-contents">

    <div class="user-name"><!-- ÊäïÁ®øËÄÖÂêç -->
      <%= link_to "#{@story.user.nickname}", user_signed_in? ? user_path(@story.user) : root_path, class: "user-name-link" %>
      <span class=user-name-sub> „Åï„Çì„ÅÆÊäïÁ®ø</span>
    </div>

    <div class="show-story-content"><!-- „Çπ„Éà„Éº„É™„ÉºÈÖçÁΩÆ -->
      <div class="show-story-item">
        <div class="show-story-item1">
          <div class="show-category-tag"><%= @story.category.name %></div>
          <div class="show-genre-tag"><%= @story.genre.name %></div>
        </div>
        <div class="show-story-item2">
          <div class="show-character-count"> <%= "#{@story.body.length}ÊñáÂ≠ó" %></div>
          <div class="show-post-date"><%= @story.created_at.strftime("%Y.%m.%d") %></div>
          <div class="detail">
            <% if user_signed_in? && current_user.id == @story.user_id %>
            <span class="toggle-detail">‚Ä¶</span>
            <ul class="detail_list" style="display: none;">
              <li><%= link_to 'Á∑®ÈõÜ', edit_story_path(@story.id), method: :get, class: "story-edit" %></li>
              <li><%= link_to 'ÂâäÈô§', story_path(@story.id), data: {turbo_method: :delete}, class:"story-destroy" %></li>
            </ul>
            <% end %>
          </div>
        </div>
      </div>
      <div class="show-story-main">
        <div class="show-story-title"><%= @story.title %></div>
        <div class="show-story-text"><%= @story.body %></div>
      </div>
    </div>

    <div class="action-contents"><!-- „É™„Ç¢„ÇØ„Ç∑„Éß„É≥„Å®Á©çË™≠ -->
      <div class="reaction-lists" data-story-id="<%= @story.id %>">
        <% reacted_kind = @story.reactions.find_by(user_id: current_user&.id)&.kind %>
        <% %w(Ê∂ô È©ö Á¨ë Êâã).each do |kind| %>
          <div class="reaction <%= 'active' if kind == reacted_kind %>" data-kind="<%= kind %>">
            <div class="one-reaction">Ôºà<%= kind %>Ôºâ</div>
          </div>
        <% end %>
      </div>
      <% if current_user %>
        <div class="bookmark-content">
          <% if current_user.bookmarked_stories.exists?(@story.id) %>
            <%= button_to "Á©çË™≠Ëß£Èô§", bookmark_path(id: @story.bookmarks.find_by(user_id: current_user.id).id), method: :delete, class: "save-bookmark" %>
          <% else %>
            <%= button_to "Á©çË™≠„Åô„Çã", bookmarks_path(story_id: @story.id), method: :post, class: "save-bookmark" %>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="comment-content"><!-- „Ç≥„É°„É≥„ÉàÊ¨Ñ -->
      <% if current_user %>
        <%= form_with model: [@story, Comment.new], local: true, data: { turbo: false } do |f| %>
          <div class="send-comment">
            <%= f.text_field :comment_box, class:"f-input-comment", id:"comment-input", placeholder:"„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ" %>
            <%= f.submit "ÈÄÅ‰ø°", name: "post-comment", class: "post-comment-btn" %>
          </div>
        <% end %>
      <% else %>
        <div class="please-login">„ÄÄìÇÉüñã„Ç≥„É°„É≥„ÉàÊäïÁ®ø„Å´„ÅØ„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô</div>
      <% end %>
      <div class="all-comments"><!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
        <% @comments.each do |comment| %>
          <div class="one-comment"><!-- Ôºë„Å§„ÅÆ„Ç≥„É°„É≥„Éà -->
            <div class="comment-user"><%= comment.user.nickname %>Ôºö<%= comment.comment_box %></div>
            <div  class="one-comment-info">
              <div class="comment-post-date"><%= comment.created_at.strftime("%Y.%m.%d") %></div>
              <% if user_signed_in? && current_user.id == comment.user_id %>
              <div class="comment-delete">
                <span class="toggle-comment-delete">‚Ä¶</span>
                <ul class=comment-action-list style="display: none;">
                  <li><%= link_to 'ÂâäÈô§', story_comment_path(@story, comment), data: {turbo_method: :delete}, class:"comment-destroy" %></li>
                </ul>
              </div>
              <% end %>
            </div>
          </div>
        <% end %>

      </div>
    </div>

  </div>

</div>
<%= render "shared/footer" %>